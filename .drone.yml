---
kind: pipeline
type: exec
name: default

platform:
  os: windows
  arch: amd64

trigger:
  refs: 
  - refs/heads/**

steps:
- name: Install packages with yarn
  environment:
    NPM_TOKEN:
      from_secret: NPM_TOKEN
  commands:
  - yarn --frozen-lockfile

- name: Run unit tests
  environment:
    NPM_TOKEN:
      from_secret: NPM_TOKEN
  commands:
  - yarn test:unit

- name: Build
  environment:
    NPM_TOKEN:
      from_secret: NPM_TOKEN
  commands:
  - yarn build

- name: Semantic Release
  when:
    branch:
      - main
  environment:
    NPM_TOKEN:
      from_secret: NPM_TOKEN
    GH_TOKEN:
      from_secret: GH_TOKEN
  commands:
  - echo %GH_TOKEN%
  - yarn semantic-release
